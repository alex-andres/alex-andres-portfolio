{"version":3,"file":"SelectRangeContext.js","sources":["../../../src/contexts/SelectRange/SelectRangeContext.tsx"],"sourcesContent":["import React from 'react';\n\nimport { differenceInCalendarDays, isAfter, isBefore } from 'date-fns';\n\nimport {\n  DateRange,\n  DayClickEventHandler,\n  DayPickerProps,\n  DayPickerRangeProps,\n  isDayPickerRange,\n  Modifiers\n} from '../../types';\nimport { addToRange } from './utils/addToRange';\n\n/** Represent the modifiers that are changed by the range selection. */\nexport type SelectRangeModifiers = Pick<\n  Modifiers,\n  'selected' | 'range_start' | 'range_end' | 'range_middle' | 'disabled'\n>;\n\n/** Represents the value of a [[SelectRangeContext]]. */\nexport interface SelectRangeContextValue {\n  /** The range of days that has been selected. */\n  selected: DateRange | undefined;\n  /** The modifiers for the corresponding selection. */\n  modifiers: SelectRangeModifiers;\n  /** Event handler to attach to the day button to enable the range select. */\n  onDayClick?: DayClickEventHandler;\n}\n\n/**\n * The SelectRange context shares details about the selected days when in\n * range selection mode.\n *\n * Access this context from the [[useSelectRange]] hook.\n */\nexport const SelectRangeContext = React.createContext<\n  SelectRangeContextValue | undefined\n>(undefined);\n\ntype SelectRangeProviderProps = {\n  initialProps: DayPickerProps;\n  children: React.ReactNode;\n};\n\n/** Provides the values for the [[SelectRangeProvider]]. */\nexport function SelectRangeProvider(\n  props: SelectRangeProviderProps\n): JSX.Element {\n  if (!isDayPickerRange(props.initialProps)) {\n    const emptyContextValue: SelectRangeContextValue = {\n      selected: undefined,\n      modifiers: {\n        selected: [],\n        range_start: [],\n        range_end: [],\n        range_middle: [],\n        disabled: []\n      }\n    };\n    return (\n      <SelectRangeContext.Provider value={emptyContextValue}>\n        {props.children}\n      </SelectRangeContext.Provider>\n    );\n  }\n  return (\n    <SelectRangeProviderInternal\n      initialProps={props.initialProps}\n      children={props.children}\n    />\n  );\n}\n\ntype SelectRangeProviderInternalProps = {\n  initialProps: DayPickerRangeProps;\n  children: React.ReactNode;\n};\n\nexport function SelectRangeProviderInternal({\n  initialProps,\n  children\n}: SelectRangeProviderInternalProps): JSX.Element {\n  const { selected } = initialProps;\n  const min = initialProps.min;\n  const max = initialProps.max;\n\n  const onDayClick: DayClickEventHandler = (day, modifiers, e) => {\n    initialProps.onDayClick?.(day, modifiers, e);\n    const newValue = addToRange(day, selected);\n    if (\n      (min || max) &&\n      selected &&\n      newValue?.to &&\n      newValue.from &&\n      newValue.from !== newValue.to\n    ) {\n      const diff = Math.abs(\n        differenceInCalendarDays(newValue?.to, newValue?.from)\n      );\n      if (min && diff < min) {\n        return;\n      }\n      if (max && diff >= max) {\n        return;\n      }\n    }\n    initialProps.onSelect?.(newValue, day, modifiers, e);\n  };\n\n  const modifiers: SelectRangeModifiers = {\n    selected: [],\n    range_start: [],\n    range_end: [],\n    range_middle: [],\n    disabled: []\n  };\n\n  if (selected) {\n    modifiers.selected = [selected];\n    if (selected.from) {\n      modifiers.range_start = [selected.from];\n      if (selected.to) {\n        modifiers.range_middle = [\n          {\n            after: selected.from,\n            before: selected.to\n          }\n        ];\n        if (max || min) {\n          modifiers.disabled = [\n            (date: Date) => {\n              if (\n                max &&\n                selected.to &&\n                selected.from &&\n                isBefore(date, selected.from)\n              ) {\n                const diff = differenceInCalendarDays(selected.to, date);\n                if (diff >= max) {\n                  return true;\n                }\n              }\n              if (\n                max &&\n                selected.to &&\n                selected.from &&\n                isAfter(date, selected.to)\n              ) {\n                const diff = differenceInCalendarDays(date, selected.from);\n                if (diff >= max) {\n                  return true;\n                }\n              }\n              if (min && selected.from && isBefore(date, selected.from)) {\n                const diff = differenceInCalendarDays(selected.from, date);\n                if (diff < min) {\n                  return true;\n                }\n              }\n              if (\n                min &&\n                selected.to &&\n                selected.from &&\n                isAfter(date, selected.to)\n              ) {\n                const diff = differenceInCalendarDays(date, selected.from);\n                if (diff < min) {\n                  return true;\n                }\n              }\n              return false;\n            }\n          ];\n        }\n        modifiers.range_end = [selected.to];\n      } else {\n        modifiers.range_end = [selected.from];\n      }\n    }\n  }\n  return (\n    <SelectRangeContext.Provider value={{ selected, onDayClick, modifiers }}>\n      {children}\n    </SelectRangeContext.Provider>\n  );\n}\n"],"names":[],"mappings":";;;;;AA8BA;;;;;;IAMa,kBAAkB,GAAG,KAAK,CAAC,aAAa,CAEnD,SAAS,EAAE;AAOb;SACgB,mBAAmB,CACjC,KAA+B;IAE/B,IAAI,CAAC,gBAAgB,CAAC,KAAK,CAAC,YAAY,CAAC,EAAE;QACzC,IAAM,iBAAiB,GAA4B;YACjD,QAAQ,EAAE,SAAS;YACnB,SAAS,EAAE;gBACT,QAAQ,EAAE,EAAE;gBACZ,WAAW,EAAE,EAAE;gBACf,SAAS,EAAE,EAAE;gBACb,YAAY,EAAE,EAAE;gBAChB,QAAQ,EAAE,EAAE;aACb;SACF,CAAC;QACF,QACE,oBAAC,kBAAkB,CAAC,QAAQ,IAAC,KAAK,EAAE,iBAAiB,IAClD,KAAK,CAAC,QAAQ,CACa,EAC9B;KACH;IACD,QACE,oBAAC,2BAA2B,IAC1B,YAAY,EAAE,KAAK,CAAC,YAAY,EAChC,QAAQ,EAAE,KAAK,CAAC,QAAQ,GACxB,EACF;AACJ,CAAC;SAOe,2BAA2B,CAAC,EAGT;QAFjC,YAAY,kBAAA,EACZ,QAAQ,cAAA;IAEA,IAAA,QAAQ,GAAK,YAAY,SAAjB,CAAkB;IAClC,IAAM,GAAG,GAAG,YAAY,CAAC,GAAG,CAAC;IAC7B,IAAM,GAAG,GAAG,YAAY,CAAC,GAAG,CAAC;IAE7B,IAAM,UAAU,GAAyB,UAAC,GAAG,EAAE,SAAS,EAAE,CAAC;;QACzD,MAAA,YAAY,CAAC,UAAU,+CAAvB,YAAY,EAAc,GAAG,EAAE,SAAS,EAAE,CAAC,CAAC,CAAC;QAC7C,IAAM,QAAQ,GAAG,UAAU,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAC;QAC3C,IACE,CAAC,GAAG,IAAI,GAAG;YACX,QAAQ;aACR,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,EAAE,CAAA;YACZ,QAAQ,CAAC,IAAI;YACb,QAAQ,CAAC,IAAI,KAAK,QAAQ,CAAC,EAAE,EAC7B;YACA,IAAM,IAAI,GAAG,IAAI,CAAC,GAAG,CACnB,wBAAwB,CAAC,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,EAAE,EAAE,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,IAAI,CAAC,CACvD,CAAC;YACF,IAAI,GAAG,IAAI,IAAI,GAAG,GAAG,EAAE;gBACrB,OAAO;aACR;YACD,IAAI,GAAG,IAAI,IAAI,IAAI,GAAG,EAAE;gBACtB,OAAO;aACR;SACF;QACD,MAAA,YAAY,CAAC,QAAQ,+CAArB,YAAY,EAAY,QAAQ,EAAE,GAAG,EAAE,SAAS,EAAE,CAAC,CAAC,CAAC;KACtD,CAAC;IAEF,IAAM,SAAS,GAAyB;QACtC,QAAQ,EAAE,EAAE;QACZ,WAAW,EAAE,EAAE;QACf,SAAS,EAAE,EAAE;QACb,YAAY,EAAE,EAAE;QAChB,QAAQ,EAAE,EAAE;KACb,CAAC;IAEF,IAAI,QAAQ,EAAE;QACZ,SAAS,CAAC,QAAQ,GAAG,CAAC,QAAQ,CAAC,CAAC;QAChC,IAAI,QAAQ,CAAC,IAAI,EAAE;YACjB,SAAS,CAAC,WAAW,GAAG,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;YACxC,IAAI,QAAQ,CAAC,EAAE,EAAE;gBACf,SAAS,CAAC,YAAY,GAAG;oBACvB;wBACE,KAAK,EAAE,QAAQ,CAAC,IAAI;wBACpB,MAAM,EAAE,QAAQ,CAAC,EAAE;qBACpB;iBACF,CAAC;gBACF,IAAI,GAAG,IAAI,GAAG,EAAE;oBACd,SAAS,CAAC,QAAQ,GAAG;wBACnB,UAAC,IAAU;4BACT,IACE,GAAG;gCACH,QAAQ,CAAC,EAAE;gCACX,QAAQ,CAAC,IAAI;gCACb,QAAQ,CAAC,IAAI,EAAE,QAAQ,CAAC,IAAI,CAAC,EAC7B;gCACA,IAAM,IAAI,GAAG,wBAAwB,CAAC,QAAQ,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;gCACzD,IAAI,IAAI,IAAI,GAAG,EAAE;oCACf,OAAO,IAAI,CAAC;iCACb;6BACF;4BACD,IACE,GAAG;gCACH,QAAQ,CAAC,EAAE;gCACX,QAAQ,CAAC,IAAI;gCACb,OAAO,CAAC,IAAI,EAAE,QAAQ,CAAC,EAAE,CAAC,EAC1B;gCACA,IAAM,IAAI,GAAG,wBAAwB,CAAC,IAAI,EAAE,QAAQ,CAAC,IAAI,CAAC,CAAC;gCAC3D,IAAI,IAAI,IAAI,GAAG,EAAE;oCACf,OAAO,IAAI,CAAC;iCACb;6BACF;4BACD,IAAI,GAAG,IAAI,QAAQ,CAAC,IAAI,IAAI,QAAQ,CAAC,IAAI,EAAE,QAAQ,CAAC,IAAI,CAAC,EAAE;gCACzD,IAAM,IAAI,GAAG,wBAAwB,CAAC,QAAQ,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;gCAC3D,IAAI,IAAI,GAAG,GAAG,EAAE;oCACd,OAAO,IAAI,CAAC;iCACb;6BACF;4BACD,IACE,GAAG;gCACH,QAAQ,CAAC,EAAE;gCACX,QAAQ,CAAC,IAAI;gCACb,OAAO,CAAC,IAAI,EAAE,QAAQ,CAAC,EAAE,CAAC,EAC1B;gCACA,IAAM,IAAI,GAAG,wBAAwB,CAAC,IAAI,EAAE,QAAQ,CAAC,IAAI,CAAC,CAAC;gCAC3D,IAAI,IAAI,GAAG,GAAG,EAAE;oCACd,OAAO,IAAI,CAAC;iCACb;6BACF;4BACD,OAAO,KAAK,CAAC;yBACd;qBACF,CAAC;iBACH;gBACD,SAAS,CAAC,SAAS,GAAG,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;aACrC;iBAAM;gBACL,SAAS,CAAC,SAAS,GAAG,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;aACvC;SACF;KACF;IACD,QACE,oBAAC,kBAAkB,CAAC,QAAQ,IAAC,KAAK,EAAE,EAAE,QAAQ,UAAA,EAAE,UAAU,YAAA,EAAE,SAAS,WAAA,EAAE,IACpE,QAAQ,CACmB,EAC9B;AACJ;;;;"}